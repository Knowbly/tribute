!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Tribute=e()}}(function(){return function(){function e(t,n,i){function r(u,l){if(!n[u]){if(!t[u]){var s="function"==typeof require&&require;if(!l&&s)return s(u,!0);if(o)return o(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var c=n[u]={exports:{}};t[u][0].call(c.exports,function(e){return r(t[u][1][e]||e)},c,c.exports,e,t,n,i)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<i.length;u++)r(i[u]);return r}return e}()({1:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("./utils"),l=(i(u),e("./TributeEvents")),s=i(l),a=e("./TributeMenuEvents"),c=i(a),d=e("./TributeRange"),h=i(d),f=e("./TributeSearch"),v=i(f),p=function(){function e(t){var n=this,i=t.values,o=void 0===i?null:i,u=t.iframe,l=void 0===u?null:u,a=t.selectClass,d=void 0===a?"highlight":a,f=t.trigger,p=void 0===f?"@":f,m=t.autocompleteMode,g=void 0!==m&&m,b=t.selectTemplate,y=void 0===b?null:b,w=t.menuItemTemplate,T=void 0===w?null:w,C=t.lookup,E=void 0===C?"key":C,S=t.fillAttr,k=void 0===S?"value":S,x=t.collection,M=void 0===x?null:x,A=t.menuContainer,L=void 0===A?null:A,N=t.scrollContainer,I=void 0===N?null:N,O=t.noMatchTemplate,P=void 0===O?null:O,D=t.headerTemplate,R=void 0===D?null:D,W=t.requireLeadingSpace,_=void 0===W||W,H=t.allowSpaces,q=void 0!==H&&H,j=t.replaceTextSuffix,K=void 0===j?null:j,B=t.positionMenu,F=void 0===B||B,z=t.spaceSelectsMatch,U=void 0!==z&&z,Y=t.selectWithComma,V=void 0!==Y&&Y,X=t.searchOpts,Q=void 0===X?{}:X,G=t.editor,J=void 0===G?{}:G,Z=t.isValidSelection,$=void 0===Z?null:Z;if(r(this,e),this.autocompleteMode=g,this.menuSelected=0,this.current={},this.inputEvent=!1,this.isActive=!1,this.menuContainer=L,this.scrollContainer=I,this.allowSpaces=q,this.replaceTextSuffix=K,this.positionMenu=F,this.hasTrailingSpace=!1,this.spaceSelectsMatch=U,this.selectWithComma=V,this.invalidEvent=document.createEvent("Event"),this.invalidEvent.initEvent("invalid",!0,!0),this.autocompleteMode&&(p="",q=!1),o)this.collection=[{trigger:p,iframe:l,selectClass:d,selectTemplate:(y||e.defaultSelectTemplate).bind(this),menuItemTemplate:(T||e.defaultMenuItemTemplate).bind(this),noMatchTemplate:function(e){return"function"==typeof e?e.bind(n):P||function(){return""}.bind(n)}(P),headerTemplate:function(e){return"function"==typeof e?e.bind(n):R||function(){return""}.bind(n)}(R),lookup:E,fillAttr:k,values:o,requireLeadingSpace:_,searchOpts:Q,editor:J,selectWithComma:V,isValidSelection:function(e){return"function"==typeof e?e.bind(n):$||function(){return""}.bind(n)}($)}];else{if(!M)throw new Error("[Tribute] No collection specified.");this.autocompleteMode&&console.warn("Tribute in autocomplete mode does not work for collections"),this.collection=M.map(function(t){return{trigger:t.trigger||p,iframe:t.iframe||l,selectClass:t.selectClass||d,selectTemplate:(t.selectTemplate||e.defaultSelectTemplate).bind(n),menuItemTemplate:(t.menuItemTemplate||e.defaultMenuItemTemplate).bind(n),noMatchTemplate:function(e){return"function"==typeof e?e.bind(n):null}(P),headerTemplate:function(e){return"function"==typeof e?e.bind(n):null}(R),lookup:t.lookup||E,fillAttr:t.fillAttr||k,values:t.values,requireLeadingSpace:t.requireLeadingSpace,searchOpts:t.searchOpts||Q,editor:t.editor||J,isValidSelection:function(e){return"function"==typeof e?e.bind(n):null}($)}})}new h.default(this),new s.default(this),new c.default(this),new v.default(this)}return o(e,[{key:"triggers",value:function(){return this.collection.map(function(e){return e.trigger})}},{key:"attach",value:function(e,t){if(!e)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if("undefined"!=typeof jQuery&&e instanceof jQuery&&(e=e.get()),e.constructor===NodeList||e.constructor===HTMLCollection||e.constructor===Array)for(var n=e.length,i=0;i<n;++i)this._attach(e[i]);else this._attach(e,t)}},{key:"_attach",value:function(e,t){e.hasAttribute("data-tribute")&&console.warn("Tribute was already bound to "+e.nodeName),this.ensureEditable(e),this.events.bind(e,t),this.scrollContainer&&this.scrollContainer.addEventListener("scroll",this.scrollEvent.bind(this)),e.setAttribute("data-tribute",!0)}},{key:"scrollEvent",value:function(e){this.events.scroll(this,e)}},{key:"ensureEditable",value:function(t){if(-1===e.inputTypes().indexOf(t.nodeName)){if(!t.contentEditable)throw new Error("[Tribute] Cannot bind to "+t.nodeName);t.contentEditable=!0}}},{key:"createMenu",value:function(){var e=this.range.getDocument().createElement("div"),t=this.range.getDocument().createElement("ul");return e.className="tribute-container",e.appendChild(t),this.menuContainer?this.menuContainer.appendChild(e):this.range.getDocument().body.appendChild(e)}},{key:"showMenuFor",value:function(e,t){var n=this;if(!this.isActive||this.current.element!==e||this.current.mentionText!==this.currentMentionTextSnapshot){this.currentMentionTextSnapshot=this.current.mentionText,this.menu||(this.menu=this.createMenu(),e.tributeMenu=this.menu,this.menuEvents.bind(this.menu)),this.isActive=!0,this.menuSelected=0,this.current.mentionText||(this.current.mentionText="");var i=function(e,i){if(n.isActive){var r=n.search.filter(n.current.mentionText,e,{pre:n.current.collection.searchOpts.pre||"<span>",post:n.current.collection.searchOpts.post||"</span>",extract:function(e){if("string"==typeof n.current.collection.lookup)return e[n.current.collection.lookup];if("function"==typeof n.current.collection.lookup)return n.current.collection.lookup(e,n.current.mentionText);throw new Error("Invalid lookup attribute, lookup must be string or function.")}});n.current.filteredItems=r;var o=n.menu.querySelector("ul");if(n.range.positionMenuAtCaret(t),n.current.collection.headerTemplate&&n.current.collection.headerTemplate(i)){var u=document.createElement("div");u.setAttribute("class","header"),u.innerHTML=n.current.collection.headerTemplate(i);var l=n.menu.querySelector(".header");l&&l.remove?l.remove():l&&!l.remove&&l.parentNode.removeChild(l),n.menu.insertBefore(u,n.menu.childNodes[0])}if(!r.length){var s=new CustomEvent("tribute-no-match",{detail:n.menu});return n.current.element.dispatchEvent(s),void(n.current.collection.noMatchTemplate?o.innerHTML=n.current.collection.noMatchTemplate():n.hideMenu())}o.innerHTML="",r.forEach(function(e,t){var i=n.range.getDocument().createElement("li");i.setAttribute("data-index",t),i.addEventListener("mousemove",function(e){var t=e.target,i=t.getAttribute("data-index")||t.parentNode&&t.parentNode.getAttribute("data-index");0!==e.movementY&&n.events.setActiveLi(i)}),n.menuSelected===t&&(i.className=n.current.collection.selectClass),i.innerHTML=n.current.collection.menuItemTemplate(e),o.appendChild(i)})}};"function"==typeof this.current.collection.values?this.current.collection.values(this.current.mentionText,i):i(this.current.collection.values,this.current.mentionText),this.menu.querySelector("ul").scrollTop=0}}},{key:"showMenuForCollection",value:function(e,t){e!==document.activeElement&&this.placeCaretAtEnd(e),this.current.collection=this.collection[t||0],this.current.externalTrigger=!0,this.current.element=e,e.isContentEditable?this.insertTextAtCursor(this.current.collection.trigger):this.insertAtCaret(e,this.current.collection.trigger),this.showMenuFor(e)}},{key:"placeCaretAtEnd",value:function(e){if(e.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}else if(void 0!==document.body.createTextRange){var i=document.body.createTextRange();i.moveToElementText(e),i.collapse(!1),i.select()}}},{key:"insertTextAtCursor",value:function(e){var t,n;t=window.getSelection(),n=t.getRangeAt(0),n.deleteContents();var i=document.createTextNode(e);n.insertNode(i),n.selectNodeContents(i),n.collapse(!1),t.removeAllRanges(),t.addRange(n)}},{key:"insertAtCaret",value:function(e,t){var n=e.scrollTop,i=e.selectionStart,r=e.value.substring(0,i),o=e.value.substring(e.selectionEnd,e.value.length);e.value=r+t+o,i+=t.length,e.selectionStart=i,e.selectionEnd=i,e.focus(),e.scrollTop=n}},{key:"hideMenu",value:function(){this.menu&&(this.menu.style.cssText="display: none;",this.isActive=!1,this.menuSelected=0,this.current={})}},{key:"selectItemAtIndex",value:function(e,t){if("number"==typeof(e=parseInt(e))&&!isNaN(e)){var n=this.current.filteredItems[e];if("function"==typeof this.current.collection.isValidSelection&&!1===this.current.collection.isValidSelection(n,this.current.collection.editor))return void this.current.collection.editor.el.dispatchEvent(this.invalidEvent);var i=this.current.collection.selectTemplate(n);null!==i&&this.replaceText(i,t,n)}}},{key:"replaceText",value:function(e,t,n){this.range.replaceTriggerText(e,!0,!0,t,n)}},{key:"_append",value:function(e,t,n){if("function"==typeof e.values)throw new Error("Unable to append to values, as it is a function.");e.values=n?t:e.values.concat(t)}},{key:"append",value:function(e,t,n){var i=parseInt(e);if("number"!=typeof i)throw new Error("please provide an index for the collection to update.");var r=this.collection[i];this._append(r,t,n)}},{key:"appendCurrent",value:function(e,t){if(!this.isActive)throw new Error("No active state. Please use append instead and pass an index.");this._append(this.current.collection,e,t)}},{key:"detach",value:function(e){if(!e)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if("undefined"!=typeof jQuery&&e instanceof jQuery&&(e=e.get()),e.constructor===NodeList||e.constructor===HTMLCollection||e.constructor===Array)for(var t=e.length,n=0;n<t;++n)this._detach(e[n]);else this._detach(e)}},{key:"_detach",value:function(e){var t=this;this.events.unbind(e),e.tributeMenu&&this.menuEvents.unbind(e.tributeMenu),this.scrollContainer&&this.scrollContainer.removeEventListener("scroll",this.scrollEvent),setTimeout(function(){e.removeAttribute("data-tribute"),t.isActive=!1,e.tributeMenu&&e.tributeMenu.remove()})}}],[{key:"defaultSelectTemplate",value:function(e){return void 0===e?null:this.range.isContentEditable(this.current.element)?'<span class="tribute-mention">'+(this.current.collection.trigger+e.original[this.current.collection.fillAttr])+"</span>":this.current.collection.trigger+e.original[this.current.collection.fillAttr]}},{key:"defaultMenuItemTemplate",value:function(e){return e.string}},{key:"inputTypes",value:function(){return["TEXTAREA","INPUT"]}}]),e}();n.default=p,t.exports=n.default},{"./TributeEvents":2,"./TributeMenuEvents":3,"./TributeRange":4,"./TributeSearch":5,"./utils":7}],2:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){i(this,e),this.tribute=t,this.tribute.events=this}return r(e,[{key:"bind",value:function(e,t){e.boundKeydown=this.keydown.bind(e,this,t),e.boundKeypress=this.keypress.bind(e,this,t),e.boundKeyup=this.keyup.bind(e,this,t),e.boundInput=this.input.bind(e,this,t),e.addEventListener("keydown",e.boundKeydown,!1),e.addEventListener("keyup",e.boundKeyup,!1),e.addEventListener("keypress",e.boundKeypress,!1),e.addEventListener("input",e.boundInput,!1)}},{key:"unbind",value:function(e){e.removeEventListener("keydown",e.boundKeydown,!1),e.removeEventListener("keyup",e.boundKeyup,!1),e.removeEventListener("keypress",e.boundKeypress,!1),e.removeEventListener("input",e.boundInput,!1),delete e.boundKeydown,delete e.boundKeypress,delete e.boundKeyup,delete e.boundInput}},{key:"scroll",value:function(e,t){e.isActive=!1,e.hideMenu()}},{key:"keydown",value:function(t,n,i){t.shouldDeactivate(i)&&(t.tribute.isActive=!1,t.tribute.hideMenu());var r=this;if(t.commandEvent=!1,e.keys().forEach(function(e){e.key===i.keyCode&&(t.commandEvent=!0,t.callbacks()[e.value.toLowerCase()](i,r,n))}),n&&[8,46].includes(i.keyCode)){var o=n.selection.get().anchorNode;e.isInsideMention(o)?e.removeCurrentMention(n,i):(i.ctrlKey||i.metaKey)&&8===i.keyCode?e.removePreviousMention(n,i):(i.ctrlKey||i.metaKey)&&46===i.keyCode&&e.removeNextMention(n,i)}}},{key:"keypress",value:function(t,n,i){n&&e.removeCurrentMention(n,i)}},{key:"input",value:function(e,t,n){e.inputEvent=!0,e.keyup.call(this,e,t,n)}},{key:"click",value:function(e,t){var n=e.tribute;if(n.menu&&n.menu.contains(t.target)){if(t.preventDefault(),t.stopPropagation(),"header"===t.target.getAttribute("class")||"UL"===t.target.tagName)return;for(var i=t.target;"li"!==i.nodeName.toLowerCase();)if(!(i=i.parentNode)||i===n.menu)throw new Error("cannot find the <li> container for the click");n.selectItemAtIndex(i.getAttribute("data-index"),t),n.hideMenu()}else n.current.element&&!n.current.externalTrigger&&(n.current.externalTrigger=!1,setTimeout(function(){return n.hideMenu()}))}},{key:"keyup",value:function(e,t,n){if(e.inputEvent&&(e.inputEvent=!1),e.updateSelection(this),27!==n.keyCode){if(t&&t.charCounter&&0===t.charCounter.count())return e.tribute.isActive=!1,void e.tribute.hideMenu();if(!e.tribute.allowSpaces&&e.tribute.hasTrailingSpace)return e.tribute.hasTrailingSpace=!1,e.commandEvent=!0,void e.callbacks().space(n,this);if(!e.tribute.isActive)if(e.tribute.autocompleteMode)e.callbacks().triggerChar(n,this,"");else{var i=e.getKeyCode(e,this,n);if(isNaN(i)||!i)return;var r=e.tribute.triggers().find(function(e){return e.charCodeAt(0)===i});void 0!==r&&e.callbacks().triggerChar(n,this,r)}((e.tribute.current.trigger||e.tribute.autocompleteMode)&&!1===e.commandEvent||e.tribute.isActive&&[8,46].includes(n.keyCode))&&e.tribute.showMenuFor(this,!0)}}},{key:"shouldDeactivate",value:function(t){if(!this.tribute.isActive)return!1;if(0===this.tribute.current.mentionText.length){var n=!1;return e.keys().forEach(function(e){t.keyCode===e.key&&(n=!0)}),!n}return!1}},{key:"getKeyCode",value:function(e,t,n){var i=e.tribute,r=i.range.getTriggerInfo(!1,i.hasTrailingSpace,!0,i.allowSpaces,i.autocompleteMode);return!!r&&r.mentionTriggerChar.charCodeAt(0)}},{key:"updateSelection",value:function(e){this.tribute.current.element=e;var t=this.tribute.range.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces,this.tribute.autocompleteMode);t&&(this.tribute.current.selectedPath=t.mentionSelectedPath,this.tribute.current.mentionText=t.mentionText,this.tribute.current.selectedOffset=t.mentionSelectedOffset)}},{key:"callbacks",value:function(){var t=this;return{triggerChar:function(e,n,i){var r=t.tribute;r.current.trigger=i;var o=r.collection.find(function(e){return e.trigger===i});r.current.collection=o,r.inputEvent&&r.showMenuFor(n,!0)},enter:function(e,n){t.tribute.isActive&&t.tribute.current.filteredItems&&(e.preventDefault(),e.stopPropagation(),setTimeout(function(){t.tribute.selectItemAtIndex(t.tribute.menuSelected,e),t.tribute.hideMenu()},0))},comma:function(e,n){t.tribute.isActive&&t.tribute.selectWithComma&&t.callbacks().enter(e,n)},escape:function(e,n){t.tribute.isActive&&(e.preventDefault(),e.stopPropagation(),t.tribute.isActive=!1,t.tribute.hideMenu())},tab:function(e,n){t.callbacks().enter(e,n)},space:function(n,i,r){if(t.tribute.isActive)t.tribute.spaceSelectsMatch?t.callbacks().enter(n,i):t.tribute.allowSpaces||(n.stopPropagation(),setTimeout(function(){t.tribute.hideMenu(),t.tribute.isActive=!1},0));else{var o=r.selection.get().anchorNode;if(e.isInsideMention(o))return n.preventDefault(),n.stopPropagation(),!1}},up:function(e,n){if(t.tribute.isActive&&t.tribute.current.filteredItems){e.preventDefault(),e.stopPropagation();var i=t.tribute.current.filteredItems.length,r=t.tribute.menuSelected;i>r&&r>0?(t.tribute.menuSelected--,t.setActiveLi()):0===r&&(t.tribute.menuSelected=i-1,t.setActiveLi(),t.tribute.menu.querySelector("ul").scrollTop=t.tribute.menu.querySelector("ul").offsetHeight)}},down:function(e,n){if(t.tribute.isActive&&t.tribute.current.filteredItems){e.preventDefault(),e.stopPropagation();var i=t.tribute.current.filteredItems.length-1,r=t.tribute.menuSelected;i>r?(t.tribute.menuSelected++,t.setActiveLi()):i===r&&(t.tribute.menuSelected=0,t.setActiveLi(),t.tribute.menu.querySelector("ul").scrollTop=0)}},delete:function(e,n,i){t.tribute.isActive&&t.tribute.current.mentionText.length<1?t.tribute.hideMenu():t.tribute.isActive&&t.tribute.showMenuFor(n)}}}},{key:"setActiveLi",value:function(e){var t=this.tribute.menu.querySelectorAll("li"),n=t.length>>>0;e&&(this.tribute.menuSelected=parseInt(e));for(var i=0;i<n;i++){var r=t[i];if(i===this.tribute.menuSelected){r.classList.add(this.tribute.current.collection.selectClass);var o=r.getBoundingClientRect(),u=this.tribute.menu.querySelector("ul").getBoundingClientRect();if(o.bottom>u.bottom){var l=o.bottom-u.bottom;this.tribute.menu.querySelector("ul").scrollTop+=l}else if(o.top<u.top){var s=u.top-o.top;this.tribute.menu.querySelector("ul").scrollTop-=s}}else r.classList.remove(this.tribute.current.collection.selectClass)}}},{key:"getFullHeight",value:function(e,t){var n=e.getBoundingClientRect().height;if(t){var i=e.currentStyle||window.getComputedStyle(e);return n+parseFloat(i.marginTop)+parseFloat(i.marginBottom)}return n}}],[{key:"keys",value:function(){return[{key:9,value:"TAB"},{key:8,value:"DELETE"},{key:13,value:"ENTER"},{key:27,value:"ESCAPE"},{key:32,value:"SPACE"},{key:38,value:"UP"},{key:40,value:"DOWN"},{key:188,value:"COMMA"}]}},{key:"remove",value:function(e){if(e&&e.remove)return void e.remove();e&&!e.remove&&e.parentNode.removeChild(e)}},{key:"isInsideMention",value:function(e){return!!(e&&e.classList&&e.classList.contains("fr-tribute"))||e&&e.parentNode&&e.parentNode.classList.contains("fr-tribute")}},{key:"removeCurrentMention",value:function(t,n){var i=void 0===n.which?n.keyCode:n.which,r=t.selection.get().anchorNode;e.removeMention(r,t,i)}},{key:"removeMention",value:function(t,n,i){if(e.isInsideMention(t)){var r=t&&t.classList&&t.classList.contains("fr-tribute"),o=r?t:t.parentNode,u=document.createDocumentFragment(),l=document.createElement("div");if(l.innerHTML="",13!==i&&(l.innerHTML="@"),l.firstChild&&u.appendChild(l.firstChild),n.selection.save(),13===i&&o.previousSibling&&o.previousSibling.previousSibling){var s=o.previousSibling.previousSibling;if(s.classList.contains("fr-tribute")){for(;s.firstChild;){var a=s.removeChild(s.firstChild);u.appendChild(a)}u.appendChild(document.createElement("br")),e.remove(o.previousSibling.previousSibling),e.remove(o.previousSibling)}}for(;o.firstChild;){var c=o.removeChild(o.firstChild);u.appendChild(c)}o.parentNode.replaceChild(u,o),n.selection.restore()}}},{key:"removePreviousMention",value:function(t,n){var i=void 0===n.which?n.keyCode:n.which,r=t.selection.get().anchorNode,o=r.previousSibling;e.removeMention(o,t,i)}},{key:"removeNextMention",value:function(t,n){var i=void 0===n.which?n.keyCode:n.which,r=t.selection.get().anchorNode,o=r.nextSibling;e.removeMention(o,t,i)}}]),e}();n.default=o,t.exports=n.default},{}],3:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){i(this,e),this.tribute=t,this.tribute.menuEvents=this,this.menu=this.tribute.menu}return r(e,[{key:"bind",value:function(e){var t=this;this.menuClickEvent=this.tribute.events.click.bind(null,this),this.menuContainerScrollEvent=this.debounce(function(){t.tribute.isActive&&t.tribute.showMenuFor(t.tribute.current.element,!1)},300,!1),this.windowResizeEvent=this.debounce(function(){t.tribute.isActive&&t.tribute.range.positionMenuAtCaret(!0)},300,!1),this.tribute.range.getDocument().addEventListener("MSPointerDown",this.menuClickEvent,!1),this.tribute.range.getDocument().addEventListener("mousedown",this.menuClickEvent,!1),window.addEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.addEventListener("scroll",this.menuContainerScrollEvent,!1):window.addEventListener("scroll",this.menuContainerScrollEvent)}},{key:"unbind",value:function(e){this.tribute.range.getDocument().removeEventListener("mousedown",this.menuClickEvent,!1),this.tribute.range.getDocument().removeEventListener("MSPointerDown",this.menuClickEvent,!1),window.removeEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.removeEventListener("scroll",this.menuContainerScrollEvent,!1):window.removeEventListener("scroll",this.menuContainerScrollEvent)}},{key:"debounce",value:function(e,t,n){var i,r=this,o=arguments;return function(){var u=r,l=o,s=function(){i=null,n||e.apply(u,l)},a=n&&!i;clearTimeout(i),i=setTimeout(s,t),a&&e.apply(u,l)}}}]),e}();n.default=o,t.exports=n.default},{}],4:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){i(this,e),this.tribute=t,this.tribute.range=this}return r(e,[{key:"getDocument",value:function(){var e=void 0;return this.tribute.current.collection&&(e=this.tribute.current.collection.iframe),e?e.contentWindow.document:document}},{key:"positionMenuAtCaret",value:function(e){var t=this,n=this.tribute.current,i=void 0,r=this.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces,this.tribute.autocompleteMode);if(void 0!==r){if(!this.tribute.positionMenu)return void(this.tribute.menu.style.cssText="display: block;");i=this.isContentEditable(n.element)?this.getContentEditableCaretPosition(r.mentionPosition):this.getTextAreaOrInputUnderlinePosition(this.tribute.current.element,r.mentionPosition),this.tribute.menu.style.cssText="top: "+i.top+"px;\n                                     left: "+i.left+"px;\n                                     right: "+i.right+"px;\n                                     bottom: "+i.bottom+"px;\n                                     position: absolute;\n                                     zIndex: 10000;\n                                     display: block;","auto"===i.left&&(this.tribute.menu.style.left="auto"),"auto"===i.top&&(this.tribute.menu.style.top="auto"),e&&this.scrollIntoView(),window.setTimeout(function(){var n={width:t.tribute.menu.offsetWidth,height:t.tribute.menu.offsetHeight},r=t.isMenuOffScreen(i,n),o=window.innerWidth>n.width&&(r.left||r.right),u=window.innerHeight>n.height&&(r.top||r.bottom);(o||u)&&(t.tribute.menu.style.cssText="display: none",t.positionMenuAtCaret(e))},0)}else this.tribute.menu.style.cssText="display: none"}},{key:"selectElement",value:function(e,t,n){var i=void 0,r=e;if(t)for(var o=0;o<t.length;o++){if(void 0===(r=r.childNodes[t[o]]))return;for(;r.length<n;)n-=r.length,r=r.nextSibling;0!==r.childNodes.length||r.length||(r=r.previousSibling)}var u=this.getWindowSelection();i=this.getDocument().createRange(),i.setStart(r,n),i.setEnd(r,n),i.collapse(!0);try{u.removeAllRanges()}catch(e){}u.addRange(i),e.focus()}},{key:"replaceTriggerText",value:function(e,t,n,i,r){var o=this.tribute.current,u=this.getTriggerInfo(!0,n,t,this.tribute.allowSpaces,this.tribute.autocompleteMode),l=new CustomEvent("tribute-replaced",{detail:{item:r,event:i}});if(void 0!==u){if(this.isContentEditable(o.element)){var s="string"==typeof this.tribute.replaceTextSuffix?this.tribute.replaceTextSuffix:" ";188===i.keyCode&&(s=","+s),e+=s,this.pasteHtml(e,u.mentionPosition,u.mentionPosition+u.mentionText.length+!this.tribute.autocompleteMode)}else{var a=this.tribute.current.element,c="string"==typeof this.tribute.replaceTextSuffix?this.tribute.replaceTextSuffix:" ";e+=c;var d=u.mentionPosition,h=u.mentionPosition+u.mentionText.length+c.length;a.value=a.value.substring(0,d)+e+a.value.substring(h,a.value.length),a.selectionStart=d+e.length,a.selectionEnd=d+e.length}o.element.dispatchEvent(l)}}},{key:"pasteHtml",value:function(e,t,n){var i=void 0,r=void 0;r=this.getWindowSelection(),i=this.getDocument().createRange(),i.setStart(r.anchorNode,t),i.setEnd(r.anchorNode,n),i.deleteContents();var o=this.getDocument().createElement("div");o.innerHTML=e;for(var u=this.getDocument().createDocumentFragment(),l=void 0,s=void 0;l=o.firstChild;)s=u.appendChild(l);i.insertNode(u),s&&(i=i.cloneRange(),i.setStartAfter(s),i.collapse(!0),r.removeAllRanges(),r.addRange(i))}},{key:"getWindowSelection",value:function(){return this.tribute.collection.iframe?this.tribute.collection.iframe.contentWindow.getSelection():window.getSelection()}},{key:"getNodePositionInParent",value:function(e){if(null===e.parentNode)return 0;for(var t=0;t<e.parentNode.childNodes.length;t++){if(e.parentNode.childNodes[t]===e)return t}}},{key:"getContentEditableSelectedPath",value:function(e){var t=this.getWindowSelection(),n=t.anchorNode,i=[],r=void 0;if(null!=n){for(var o=void 0,u=n.contentEditable;null!==n&&"true"!==u;)o=this.getNodePositionInParent(n),i.push(o),null!==(n=n.parentNode)&&(u=n.contentEditable);return i.reverse(),r=t.getRangeAt(0).startOffset,{selected:n,path:i,offset:r}}}},{key:"getTextPrecedingCurrentSelection",value:function(){var e=this.tribute.current,t="";if(this.isContentEditable(e.element)){var n=this.getWindowSelection().anchorNode;if(null!=n){var i=n.textContent,r=this.getWindowSelection().getRangeAt(0).startOffset;i&&r>=0&&(t=i.substring(0,r))}}else{var o=this.tribute.current.element;if(o){var u=o.selectionStart;o.value&&u>=0&&(t=o.value.substring(0,u))}}return t}},{key:"getLastWordInText",value:function(e){e=e.replace(/\u00A0/g," ");var t=e.split(" ");return t[t.length-1].trim()}},{key:"getTriggerInfo",value:function(e,t,n,i,r){var o=this,u=this.tribute.current,l=void 0,s=void 0,a=void 0;if(this.isContentEditable(u.element)){var c=this.getContentEditableSelectedPath(u);c&&(l=c.selected,s=c.path,a=c.offset)}else l=this.tribute.current.element;var d=this.getTextPrecedingCurrentSelection(),h=this.getLastWordInText(d);if(r)return{mentionPosition:d.length-h.length,mentionText:h,mentionSelectedElement:l,mentionSelectedPath:s,mentionSelectedOffset:a};if(void 0!==d&&null!==d){var f=-1,v=void 0;if(this.tribute.collection.forEach(function(e){var t=e.trigger,i=e.requireLeadingSpace?o.lastIndexWithLeadingSpace(d,t):d.lastIndexOf(t);i>f&&(f=i,v=t,n=e.requireLeadingSpace)}),f>=0&&(0===f||!n||/[\xA0\s]/g.test(d.substring(f-1,f)))){var p=d.substring(f+1,d.length);v=d.substring(f,f+1);var m=p.substring(0,1),g=p.length>0&&(" "===m||" "===m);t&&(p=p.trim());var b=i?/[^\S ]/g:/[\xA0\s]/g;if(this.tribute.hasTrailingSpace=b.test(p),!g&&(e||!b.test(p)))return{mentionPosition:f,mentionText:p,mentionSelectedElement:l,mentionSelectedPath:s,mentionSelectedOffset:a,mentionTriggerChar:v}}}}},{key:"lastIndexWithLeadingSpace",value:function(e,t){for(var n=e.split("").reverse().join(""),i=-1,r=0,o=e.length;r<o;r++){var u=r===e.length-1,l=/\s/.test(n[r+1]);if(t===n[r]&&(u||l)){i=e.length-1-r;break}}return i}},{key:"isContentEditable",value:function(e){return"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName}},{key:"isMenuOffScreen",value:function(e,t){var n=window.innerWidth,i=window.innerHeight,r=document.documentElement,o=(window.pageXOffset||r.scrollLeft)-(r.clientLeft||0),u=(window.pageYOffset||r.scrollTop)-(r.clientTop||0),l="number"==typeof e.top?e.top:u+i-e.bottom-t.height,s="number"==typeof e.right?e.right:e.left+t.width,a="number"==typeof e.bottom?e.bottom:e.top+t.height,c="number"==typeof e.left?e.left:o+n-e.right-t.width;return{top:l<Math.floor(u),right:s>Math.ceil(o+n),bottom:a>Math.ceil(u+i),left:c<Math.floor(o)}}},{key:"getMenuDimensions",value:function(){var e={width:null,height:null};return this.tribute.menu.style.cssText="top: 0px;\n                                 left: 0px;\n                                 position: fixed;\n                                 zIndex: 10000;\n                                 display: block;\n                                 visibility; hidden;",e.width=this.tribute.menu.offsetWidth,e.height=this.tribute.menu.offsetHeight,this.tribute.menu.style.cssText="display: none;",e}},{key:"getTextAreaOrInputUnderlinePosition",value:function(e,t,n){var i=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],r=null!==window.mozInnerScreenX,o=this.getDocument().createElement("div");o.id="input-textarea-caret-position-mirror-div",this.getDocument().body.appendChild(o);var u=o.style,l=window.getComputedStyle?getComputedStyle(e):e.currentStyle;u.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(u.wordWrap="break-word"),u.position="absolute",u.visibility="hidden",i.forEach(function(e){u[e]=l[e]}),r?(u.width=parseInt(l.width)-2+"px",e.scrollHeight>parseInt(l.height)&&(u.overflowY="scroll")):u.overflow="hidden",o.textContent=e.value.substring(0,t),"INPUT"===e.nodeName&&(o.textContent=o.textContent.replace(/\s/g," "));var s=this.getDocument().createElement("span");s.textContent=e.value.substring(t)||".",o.appendChild(s);var a=e.getBoundingClientRect(),c=document.documentElement,d=(window.pageXOffset||c.scrollLeft)-(c.clientLeft||0),h=(window.pageYOffset||c.scrollTop)-(c.clientTop||0),f={top:a.top+h+s.offsetTop+parseInt(l.borderTopWidth)+parseInt(l.fontSize)-e.scrollTop,left:a.left+d+s.offsetLeft+parseInt(l.borderLeftWidth)},v=window.innerWidth,p=window.innerHeight,m=this.getMenuDimensions(),g=this.isMenuOffScreen(f,m);g.right&&(f.right=v-f.left,f.left="auto");var b=this.tribute.menuContainer?this.tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(g.bottom){var y=this.tribute.menuContainer?this.tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect(),w=b-(p-y.top);f.bottom=w+(p-a.top-s.offsetTop),f.top="auto"}return g=this.isMenuOffScreen(f,m),g.left&&(f.left=v>m.width?d+v-m.width:d,delete f.right),g.top&&(f.top=p>m.height?h+p-m.height:h,delete f.bottom),this.getDocument().body.removeChild(o),f}},{key:"getContentEditableCaretPosition",value:function(e){var t=void 0,n="sel_"+(new Date).getTime()+"_"+Math.random().toString().substr(2),i=void 0,r=this.getWindowSelection(),o=r.getRangeAt(0);i=this.getDocument().createRange(),i.setStart(r.anchorNode,e),i.setEnd(r.anchorNode,e),i.collapse(!1),t=this.getDocument().createElement("span"),t.id=n,t.appendChild(this.getDocument().createTextNode("\ufeff")),i.insertNode(t),r.removeAllRanges(),r.addRange(o);var u=t.getBoundingClientRect(),l=document.documentElement,s=(window.pageXOffset||l.scrollLeft)-(l.clientLeft||0),a=(window.pageYOffset||l.scrollTop)-(l.clientTop||0),c={left:u.left+s,top:u.top+t.offsetHeight+a},d=window.innerWidth,h=window.innerHeight,f=this.getMenuDimensions(),v=this.isMenuOffScreen(c,f);v.right&&(c.left="auto",c.right=d-u.left-s);var p=this.tribute.menuContainer?this.tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(v.bottom){var m=this.tribute.menuContainer?this.tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect(),g=p-(h-m.top);c.top="auto",c.bottom=g+(h-u.top)}return v=this.isMenuOffScreen(c,f),v.left&&(c.left=d>f.width?s+d-f.width:s,delete c.right),v.top&&(c.top=h>f.height?a+h-f.height:a,delete c.bottom),t.parentNode.removeChild(t),c}},{key:"scrollIntoView",value:function(e){var t=20,n=void 0,i=100,r=this.menu;if(void 0!==r){for(;void 0===n||0===n.height;)if(n=r.getBoundingClientRect(),0===n.height&&(void 0===(r=r.childNodes[0])||!r.getBoundingClientRect))return;var o=n.top,u=o+n.height;if(o<0)window.scrollTo(0,window.pageYOffset+n.top-t);else if(u>window.innerHeight){var l=window.pageYOffset+n.top-t;l-window.pageYOffset>i&&(l=window.pageYOffset+i);var s=window.pageYOffset-(window.innerHeight-u);s>l&&(s=l),window.scrollTo(0,s)}}}}]),e}();n.default=o,t.exports=n.default},{}],5:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){i(this,e),this.tribute=t,this.tribute.search=this}return r(e,[{key:"simpleFilter",value:function(e,t){var n=this;return t.filter(function(t){return n.test(e,t)})}},{key:"test",value:function(e,t){return null!==this.match(e,t)}},{key:"match",value:function(e,t,n){n=n||{};var i=(t.length,n.pre||""),r=n.post||"",o=n.caseSensitive&&t||t.toLowerCase();e=n.caseSensitive&&e||e.toLowerCase();var u=this.traverse(o,e,0,0,[]);return u?{rendered:this.render(t,u.cache,i,r),score:u.score}:null}},{key:"traverse",value:function(e,t,n,i,r){if(t.length===i)return{score:this.calculateScore(r),cache:r.slice()};if(!(e.length===n||t.length-i>e.length-n)){for(var o=t[i],u=e.indexOf(o,n),l=void 0,s=void 0;u>-1;){if(r.push(u),s=this.traverse(e,t,u+1,i+1,r),r.pop(),!s)return l;(!l||l.score<s.score)&&(l=s),u=e.indexOf(o,u+1)}return l}}},{key:"calculateScore",value:function(e){var t=0,n=1;return e.forEach(function(i,r){r>0&&(e[r-1]+1===i?n+=n+1:n=1),t+=n}),t}},{key:"render",value:function(e,t,n,i){var r=e.substring(0,t[0]);return t.forEach(function(o,u){r+=n+e[o]+i+e.substring(o+1,t[u+1]?t[u+1]:e.length)}),r}},{key:"filter",value:function(e,t,n){var i=this;return n=n||{},t.reduce(function(t,r,o,u){var l=r;n.extract&&((l=n.extract(r))||(l=""));var s=i.match(e,l,n);return null!=s&&(t[t.length]={string:s.rendered,score:s.score,index:o,original:r}),t},[]).sort(function(e,t){var n=t.score-e.score;return n||e.index-t.index})}}]),e}();n.default=o,t.exports=n.default},{}],6:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./Tribute"),o=i(r);n.default=o.default,t.exports=n.default},{"./Tribute":1}],7:[function(e,t,n){"use strict";if(Array.prototype.find||(Array.prototype.find=function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,r=arguments[1],o=0;o<i;o++)if(t=n[o],e.call(r,t,o,n))return t}),window&&"function"!=typeof window.CustomEvent){var i=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n};void 0!==window.Event&&(i.prototype=window.Event.prototype),window.CustomEvent=i}},{}]},{},[6])(6)});
//# sourceMappingURL=tribute.min.js.map